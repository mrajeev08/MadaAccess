---
title: "Supplementary Appendix"
subtitle: "How geographic access to care shapes disease burden: the current impact of post-exposure prophylaxis and potential for expanded access to prevent human rabies deaths in Madagascar"
author:
  - Malavika Rajeev:
      email: mrajeev@princeton.edu
      institute: [Princeton]
      correspondence: true
  - Hélène Guis:
      institute: [IPMepi, cirad, astre, fofifa]
      correspondence: false
  - Glenn Edosoa:
      institute: [OMS]
      correspondence: false
  - Chantal Hanitriniaina:
      institute: [UoA]
      correspondence: false
  - Anjasoa Randrianarijaona:
      institute: [IPMepi]
      correspondence: false
  - Reziky Tiandraza Mangahasimbola:
      institute: [IPMepi]
      correspondence: false
  - Fleur Hierink:
      institute: [Geneva]
      correspondence: false
  - Ravo Ramiandrasoa:
      institute: [IPMvacc]
      correspondence: false
  - José Nely:
      institute: [smeetn]
  - Jean-Michel Heraud:
      institute: [IPMviro]
      correspondence: false
  - Soa Fy Andriamandimby:
      institute: [IPMviro]
      correspondence: false
  - Laurence Baril:
      institute: [IC]
      correspondence: false
      equal_contributor: "yes"
  - C.J.E. Metcalf:
      institute: [Princeton]
      correspondence: false
      equal_contributor: "yes"
  - Katie Hampson:
      institute: [Glasgow]
      correspondence: false
      equal_contributor: "yes"
institute:
  - Princeton: Department of Ecology and Evolutionary Biology, Princeton University, Princeton, United States
  - IPMepi: Epidemiology and Clinical Research Unit, Institut Pasteur de Madagascar, Antananarivo, Madagascar
  - cirad: CIRAD, UMR ASTRE, Antananarivo, Madagascar
  - astre: ASTRE, Univ Montpellier, CIRAD, INRAE, Montpellier, France
  - fofifa: FOFIFA-DRZVP, Antananarivo, Madagascar6 World Health Organization, Madagascar
  - smeetn: Service contre les Maladies Endémo-épidémiques et Tropicales  Négligées, Ministère de la Santé Publique, Antananarivo, Madagascar
  - OMS: Chargé des Maladies Tropicales Négligées, Organisation mondiale de la Santé Madagascar, Antananarivo, Madagascar
  - UoA: Mention Zoologie et Biodiversité Animale, Faculté des Sciences, Université d’Antananarivo, Antananarivo, Madagascar
  - Geneva: Institute of Global Health, Faculty of Medicine, University of Geneva, Geneva, Switzerland
  - IPMvacc: Vaccination Center, Institut Pasteur de Madagascar, Antananarivo, Madagascar
  - IPMviro: Virology Unit, Institut Pasteur de Madagascar, Antananarivo, Madagascar
  - IC: Institut Pasteur du Cambodge (previously Epidemiology and Clinical Research Unit at Institut pasteur de Madagascar)
  - Glasgow: Boyd Orr Centre for Population and Ecosystem Health, Institute of Biodiversity, Animal Health and Comparative Medicine, University of Glasgow, Glasgow, UK
date: ""
nocite: '@*'
link-citations: no
output:
  bookdown::word_document2:
    toc: true
    pandoc_args:
      - --csl=format/plos-neglected-tropical-diseases.csl
      - --filter=pandoc-crossref
      - --lua-filter=format/scholarly-metadata.lua
      - --lua-filter=format/author-info-blocks.lua
      - --lua-filter=format/pagebreak.lua
      - --lua-filter=format/multiple-bibliographies.lua
      - --reference-doc=format/reference_supplement.docx
keywords: "canine rabies, post-exposure prophylaxis, Gavi, Zero by 30, access to care"
bibliography_supp: ["bib/refs_pkgs.bib"]
bibliography_supextra: ["bib/refs_supextra.bib"]
---
<!-- Do not edit this file by hand, only for submission! -->
```{r setupmain, include=FALSE}
start <- Sys.time()

# Libraries
library(knitr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(data.table)
library(sf)
library(glue)
library(here)
library(magrittr)
source(here("R", "utils.R"))

opts_chunk$set(echo = FALSE, warning = FALSE, 
                message=FALSE, out.width="80%")

trans_perc <- function(x) {
  round(x, 2)*100
}

# data
ctar_metadata <- fread(here("data-raw/out/clinics/ctar_metadata.csv"))
district_bites <- fread(here("analysis/out/bites/district_bites.csv"))
mora_bites <- fread(here("analysis/out/bites/mora_bites.csv"))
mada_communes <- st_read(here("analysis/out/shapefiles/mada_communes.shp"))
mada_districts <- st_read(here("analysis/out/shapefiles/mada_districts.shp"))

# All preds (for abstract stats etc)
natl_preds <- fread(here("analysis/out/preds/natl_preds.gz"))
natl_base <- natl_preds[scenario == 0]

natl_preds %>%
  filter(scenario == 0) %>%
  mutate(prop_averted = averted_mean/(deaths_mean + averted_mean)) %>%
  select(prop_averted) -> prop_averted

admin_base <- fread(here("analysis/out/preds/admin_preds_base.gz"))

# candidate points
csbs <- fread(here("data-raw/out/clinics/csb2.csv"))
clin_per_comm <- fread(here("data-raw/out/clinics/clinic_per_comm.csv"))
clin_per_dist <- fread(here("data-raw/out/clinics/clinic_per_dist.csv"))

comms_no_csb2 <- nrow(clin_per_comm[type == "CSB1"])

comms_no_clins <- 
  nrow(mada_communes) - 
  length(unique(c(clin_per_comm$commcode, 
                  clin_per_dist$commcode, 
                  ctar_metadata$commcode)))

csbs_max <- rbind(csbs, clin_per_comm[!(clinic_id %in% csbs$clinic_id)], fill = TRUE)
csb2_max <- sum(csbs_max$type == "CSB2")
csb1_max <- sum(csbs_max$type == "CSB1")
max_added <- max(natl_preds$scenario)
natl_preds %>%
  group_by(scale, data_source) %>%
  arrange(scenario) %>%
  mutate_at(vars(-c(group_cols(), scenario)), function(x) x/x[1]) -> props
trends <- read.csv(here("analysis/out/stats/trends_adminpreds.csv"))

one_per_dist <- nrow(clin_per_dist)
one_per_comm <- sort(natl_preds$scenario, decreasing = TRUE)[2]

no_figs <- FALSE
if(no_figs) include_graphics <- function(x, ...) { return(invisible(NULL)) }

# for logging dependencies
out_session("logs/log_local.csv", start = start, 
            ncores = 1)
```

<!-- split -->

\newpage


## S1. Estimating travel times to the closest ARMC {#S1}

```{r fig S1.1 inputs A friction B pop}
include_graphics(here("analysis/figs/supplementary/S1.1_inputs.jpeg"))
```

### *Fig S1.1. Raster inputs to estimate travel times to the closest ARMC for Madagascar.*
_(A) Friction surface of travel speeds (in minutes per meter) at an ~ 1x1 km scale. (B) Population estimates resampled to the same friction surface._

\newpage
    
```{r fig S1.2 ttimes A Moramanga B Drive}
include_graphics(here("analysis/figs/supplementary/S1.2_raw.jpeg"))
```

### *Fig S1.2. Raw patient reported and driving travel time data.*
_(A) Distribution of travel times estimated at the grid cell level and reported by patients for each commune where patient data were available from the Moramanga ARMC. (B) Reported driving times between locations, with the color corresponding to the total driving time and the size of the line showing the direction of travel (narrow to wide ~ origin to destination). Paths are bezier curves from origin to destination, and do not show actual paths driven._

\newpage

```{r fig S1.3 travel modes}
include_graphics(here("analysis/figs/supplementary/S1.3_modes.jpeg"))
```

### *Fig S1.3. Reported modes of transport used compared to reported travel times for patients reporting to the Moramanga ARMC.*
\newpage
    
  
```{r fig S1.4 lms ttimes}
include_graphics(here("analysis/figs/supplementary/S1.4_lms.jpeg"))
```

### *Fig S1.4. Observed estimates of travel times (commune means of patient reported travel times and driving times between point locations).*
_Predicted by (A) Distance (km) (Euclidean distance between origin and destination for driving times and distance from the commune centroid to the Moramanga ARMC for commune means) (B) Travel time estimates and (C) Travel time estimates weighted by population (for commune means only)._   
\newpage

### *Table S1.1. R^2^ values from linear models with estimated access metrics predicting either driving times or commune means of patient reported travel times.*
```{r table S1.1 lms table}
S1.1_table <- read.csv(here("analysis/out/stats/access_met_r2.csv"), row.names = 1)
kable(S1.1_table, col.names = c("Predictor", "Driving times", 
                                "Commune mean of patient reported travel times"),
      digits = 3)
```
  
 \newpage
 

```{r fig S1.5 output ttimes A district B commune}
include_graphics(here("analysis/figs/supplementary/S1.5_outputs.jpeg"))
```

### *Fig S1.5. Estimates of mean travel times weighted by population at the (A) District (B) Commune scale.* 

\newpage

## S2. Estimating bite incidence 
Vial demand was simulated under simplified assumptions of PEP administration and adherence [@rajeevHealthcareUtilizationProvisioning2019], based on patients reported randomly across the year. During this period, the Thai Red Cross Intradermal regimen was used across Madagascar, with 0.2 mL administered per patient completing doses on days 0, 3, 7, and 28. Vials can be shared within a day between two patients, resulting in 0.1ml wastage per vial shared, plus any additional wastage from unused doses discarded at the end of the day. We estimate vial estimates as the midpoint estimate if all patients complete 3 vs. 4 doses. As clinic submission of forms was highly variable from 2014-2017 (Fig S2.2A), we compared estimated demand to the total vials provisioned across this four year period comparing different thresholds for correcting for periods of no form submission (i.e, designating periods of 1, 5, 10, 15, and 30 consecutive days with zero submitted records as missing, compared to no correction).

Estimates of vial demand based on uncorrected bite patient numbers were generally lower than the number of vials provisioned for those clinics with substantial under-submission of forms (Fig S2.2B). Correcting patient numbers for under-submission resulted in estimates of vial demand closer to the provisioned vials for most clinics  (Fig S2.2C, Table S2.1). 

\newpage

```{r fig S2.1 A catchments B closest C Prop bites}
include_graphics(here("analysis/figs/supplementary/S2.1_catchments.jpeg"))
```

### *Fig S2.1. Catchment assignments by travel time.*
*(A) Catchments as assigned by closest clinic for the majority of the population within a commune (polygon fill) or within a district (polygon outline). Admin units where the fill and border colors do not match show places where assigned catchments differ at the district vs commune scale. (B) Distribution of the proportion of the population in a given administrative unit (district or commune) served by the catchment assigned. (C) The proportion of bites reported to each clinic which originated from a district within the assigned catchment. The vertical line indicates the proportion of bites from within the assigned catchment for the Moramanga data (~90%). *
  
\newpage

```{r fig 2.2 form sub A time series B reporting C vial comp}
include_graphics(here("analysis/figs/supplementary/S2.2_vialcomps.jpeg"))
```

### *Fig S2.2. Estimating undersubmission of patient forms.*
*(A) The daily time series of the number of forms submitted by each clinic, with periods of time where no forms were submitted for >= 15 days excluded (in white). (B) Estimates for the proportion of forms submitted for each clinic (points are the estimate for each year) calculated as the # of days in a year which were not excluded based on the criteria of 15 consecutive days of non-submission/365. (C) The difference between log(estimated) and log(observed) vials provisioned for the period of 2013 - 2017 for each clinic correcting for under-submission (squares) using the 15 day cut-off show in A and B, vs. not correcting for under-submission (circles). We did not have data on vials provisioned for IPM.*
\newpage

### *Table S2.1. Root mean squared error (MSE) between observed vials provisioned and estimated by the different consecutive day threshold for correcting for periods of no form submission, with the minimum root MSE in bold.*
```{r table mse stat}
mse <- read.csv(here("analysis/out/stats/vial_mse.csv"))
mse %>%
  mutate(cut_off = case_when(cut_off == 0 ~ "1", 
                             cut_off == Inf ~ "No correction", 
                             !(cut_off %in% c(0, Inf)) ~ as.character(cut_off))) %>%
  select(`Consecutive day threshold` = cut_off, `Root MSE` = mse) -> mse
mse[which.min(mse$`Root MSE`), ] <- paste0("**", mse[which.min(mse$`Root MSE`), ], "**")
kable(mse)
```
\newpage

## S3. Modeling reported bite incidence
We used a weakly informative prior for the intercept of the models centered around the mean of the bite incidence for the given dataset with a standard deviation of 10. For the covariate terms, we centered the priors around zero with a standard deviation of 10. For the variance terms ($\sigma_0$ and $\sigma_e$), we set uniform priors ($unif(0, 5)$). We calculated the Deviance Information Criterion (DIC, a metric of model fit to data) for each candidate model as well as the maximum potential scale reduction factors (psrf) for each covariate and the multivariate psrf for the whole model (both are metrics of model convergence, where values < 1.1 are indicative of convergence, Table S3.1) [@gelman2006data].

To test how well our models predicted the data, we sampled parameter estimates from the posterior distribution for each model to generate predictions to compare to data. In addition, we used the models to predict out-of-fit data (i.e. estimates from models fitted to the national data were used to predict the Moramanga data, and estimates from models fitted to the Moramanga data were used to predict the national data). Finally, to check how correcting for incomplete submission of forms affected our modeling results, we fitted our final models to the raw data uncorrected for submission (i.e. assuming forms were completely reported resulting in lower estimates of bite incidence) and with a lower cut-off (7 days, resulting in higher estimates of under-submission of forms).

\newpage

  
```{r fig S3.1 corr pop ttimes}
include_graphics(here("analysis/figs/supplementary/S3.1_corrs.jpeg"))
```

### *Fig S3.1. Correlation between travel time in hours (the average weighted by the population) and population size of administrative units at the district and commune scale.*

\newpage
  

### *Table S3.1. DIC and convergence estimates (maximum potential scale reduction factor and multivariate psrf, values < 1.1 indicate convergence) for all models.*
*For the column pop effect, addPop = models with population size as additional covariate, onlyPop = models with population as only covariate, flatPop = models with population as offset in model. For the intercept type: random = random intercept by catchment, fixed = a single fixed intercept was estimated). The Overdispersion column indicates whether an overdispersion parameter was estimated (yes) or not (no). *
```{r table S3.1 dic}
model_ests <- read.csv(here("analysis/out/mods/estimates.csv"))

model_ests %>%
  group_by(data_source, scale, pop_predict, intercept, OD) %>%
  summarize(dic = max(dic),
            psrf_max = max(psrf_upper),
            mpsrf = max(mpsrf)) -> dic_ests
dic_ests %>%
  group_by(data_source, scale) %>%
  mutate(min = case_when(dic == min(dic) ~ "Min",
                         TRUE ~ ""), 
         OD = case_when(OD == TRUE ~ "yes", 
                        OD == FALSE ~ "no"),
         across(where(is.numeric), 
                function(x) as.character(round(x, 3)))) %>%
  arrange(dic, .by_group = TRUE) -> dic_ranks

dic_ranks[dic_ranks$min == "Min", ] <- 
  apply(dic_ranks[dic_ranks$min == "Min", ], 2,  function(x) paste0("**", x, "**"))

knitr::kable(select(dic_ranks, -min), 
             col.names = c("Dataset", "Scale", "Pop effect", "Intercept type",
                           "Overdispersion",
                           "DIC", "Max psrf", "Multivariate psrf"),
             digits = 3)
```

\newpage

  
```{r fig S3.2 obs vs predicted, out.width="65%"}
include_graphics(here("analysis/figs/supplementary/S3.2_fitted.jpeg"))
```

### *Fig S3.2. Prediction to data used to fit each model.*
*Log of the observed bites against the log of predicted bites generated from sampling 1000 independent draws from the posterior distributions for each parameter, with the points the mean of the predictions and the linerange the 95% prediction intervals. Columns are by the type of model intercept (either a fixed intercept or a random intercept by catchment) and rows are the type of model structure with respect to the population covariate (addPop = population size as additional covariate, onlyPop = population as only covariate, flatPop = population as offset in model). Colors show which data set was used for fitting and the scale of the model (Moramanga = Moramanga data with covariates at the commune level, Commune = National data with covariates at the commune level, District = National data with covariates at the district level).*


\newpage

```{r fig S3.3 out of fit}
include_graphics(here("analysis/figs/supplementary/S3.3_outfit.jpeg"))
```

### *Fig S3.3. Out of fit predictions to data.*
*Log of the observed bites against the log of predicted bites for data not used to fit the model. Predictions were generated by sampling 1000 independent draws from the posterior distributions for each parameter, with the points the mean of the predictions and the linerange the 95% prediction intervals. The first two columns are the predictions from the commune and district model fitted to the national data for the Moramanga data with fixed and random intercepts. The third column are predictions from models fitted to the Moramanga data for the national data at the commune and district scale (only fixed intercept models). Rows are the type of model structure with respect to the population covariate and colors show which data set was used for fitting as per Fig S3.2.*
\newpage


```{r fig S3.4 od comp posts}
include_graphics(here("analysis/figs/supplementary/S3.4_posts_all.jpeg"))
```

### *Fig S3.4. Posterior estimates of parameters from models with travel time and population as an offset.*
*Comparing models accounting for overdispersion ($\sigma_e$) compared to models with no overdispersion parameter  (flatPop in Figs S3.2 & S3.3). For the Moramanga model, as data came from a single catchment, models with a random catchment effect ($\sigma_0$) were not fitted.*
  
 \newpage
 
```{r fig S3.5 od comp preds}
include_graphics(here("analysis/figs/supplementary/S3.5_preds_OD.jpeg"))
```

### *Fig S3.5. Predicted relationship between travel times (in hours) and reported bite incidence per 100,000 persons.* 
*Generated from sampling 1000 independent draws from the posterior distributions for each parameter, with the line the mean of the predictions and the envelopes showing the 95% prediction intervals. Rows are by the type of model intercept (either a fixed intercept or a random intercept by catchment) and columns are whether the model estimated an overdispersion parameter. The points show the data used to fit the models (the National dataset), as well as the Moramanga dataset. Note the different y-axis limits between the fixed and random intercept models.* 
\newpage


```{r fig S3.6 random vs od}
include_graphics(here("analysis/figs/supplementary/S3.6_posts_intercepts.jpeg"))
```

### *Fig S3.6. Posterior estimates of the catchment intercepts ($\alpha$ parameters, with $\beta_0$ the estimated mean intercept) for models with and without an overdispersion parameter.*

\newpage
  
  
```{r fig S3.7 random vs od}
include_graphics(here("analysis/figs/supplementary/S3.7_preds_ODcomp.jpeg"))
```

### *Fig S3.7. Predicted relationship between travel times (in hours) and reported bite incidence per 100,000 persons.*
*For random intercept model without overdispersion vs. fixed intercept model with overdispersion, generated from sampling 1000 independent draws from the posterior distributions for each parameter, with the line the mean of the predictions and the envelopes showing the 95% prediction intervals. The points show the data used to fit the models (the National dataset), as well as the Moramanga dataset.*

\newpage

  
  
```{r fig S3.8 rep cutoff posts}
include_graphics(here("analysis/figs/supplementary/S3.8_posts_rep_se.jpeg"))
```

### *Fig S3.8. Posterior estimates for models with population as an offset and an overdispersion parameter.*
*Columns show estimates from models fitted to the national dataset (1) corrected for both under-submission by correcting for periods of at least 7 days where zero patient forms were submitted, (2) correcting for periods of 15 days where zero patient forms were submitted, and (3) with the raw data not correcting for under-submission.*

  
 \newpage
 

```{r fig S3.9 rep cutoff preds}
include_graphics(here("analysis/figs/supplementary/S3.9_preds_rep_se.jpeg"))
```

### *Fig S3.9. The estimated relationship between travel time in hours (x-axis) and mean annual bite incidence per 100,000 persons (y-axis).*
*For models with population as an offset and an overdispersion parameter. Panels show predictions from models fitted to the national dataset 1) correcting for periods of at least 7 days where zero patient forms were submitted (a less stringent cutoff resulting in lower estimates of the proportion of forms submitted and thus higher estimates of reported bite incidence), (2) correcting for periods of 15 days where zero patient forms where submitted, as presented in the main analysis, and (3) with the raw data not correcting for under-submission (resulting in lower estimates of reported bite incidence). Predictions were generated from sampling 1000 independent draws from the posterior distributions for each parameter, with the line the mean of the predictions and the envelopes showing the 95% prediction intervals. The points show the data used to fit the models.* 
\newpage

## S4. Range of rabies exposure incidence in people

```{r fig S4.1 exp range}
include_graphics(here("analysis/figs/supplementary/S4.1_exprange.jpeg"))
```

### *Fig S4.1. Estimated exposures per 100,000 given a range of human to dog ratios (HDRs, x-axis) and annual dog rabies incidence (y axis).* 
*Assuming that each dog on average exposes 0.39 persons [@hampsonSurveillanceEstablishElimination2016]. The black dashed lines show the range of human to dog ratios (HDRs) we use in the main analysis to estimate the range of human exposure incidence (where the red horizontal line and black dashed lines intersect). The grey dashed lines show the HDRs estimated from the Moramanga district from a recent study [@sambo2018estimating]. The cells with red outlines show the range of estimated exposure incidence from a previous study of bite patients in Moramanga District [@rajeevHealthcareUtilizationProvisioning2019].*  
\newpage


```{r fig S4.2 scaling factors}
include_graphics(here("analysis/figs/supplementary/S4.2_scaling_rels.jpeg"))
```

### *Fig S4.2. Range of constrained scaling factors generated for district and commune population size* 
*Underlying rabies exposures either (A) decreases with increasing population size or (B) increases with increasing population size across a fixed range of exposure incidence (15.6 - 76 exposures/100k persons). Lines show the expected relationship, with points showing where administrative units fall along this curve, and maps show how this results in variation in assumed exposure incidence spatially at the commune and district level.* 
\newpage

  
## S5. Estimating the impact of expanding PEP provisioning to additional clinics {#S5}
  
```{r fig S5.1 metrics}
include_graphics(here("analysis/figs/supplementary/S5.1_tests.jpeg"))
```

### *Fig S5.1. Comparing metrics for ranking clinics for targeted expansion.*  
*We simulated expansion using three different ranking metrics: 1) reduction in mean travel times (green line) 2) the proportion of the population for which travel times were reduced (red dashed line) and 3) the proportion of the population for which travel times were reduced weighted by the reduction in travel times (pink dashed line). For each of these, we simulated burden using our decision tree framework (y axis is the mean of 1000 simulations of annual deaths at the national level). The blue lines show 10 simulations of randomly expanding access on reducing burden as a comparator. The panels show to the commune and district model of reported bite incidence.*
\newpage

  
```{r fig S5.2 add clinics}
include_graphics(here("analysis/figs/supplementary/S5.2_ARMCadded.jpeg"))
```

### *Fig S5.2. Map of the location and at what step each clinic was added.*
*The circles are each of the CSB II across the country sized by the resulting average reduction in burden (based on smoothed annual burden estimates from the commune model, see inset). The large white crosses show the location of the existing 31 ARMC in Madagascar and the smaller white crosses are the additional CSB II in the country which were added in the final step but not ranked.* 
\newpage
 
```{r fig S5.3 map shifts}
include_graphics(here("analysis/figs/supplementary/S5.3_map_shifts.jpeg"))
```

### *Fig S5.3. Maps of how travel times change as clinics are added.*
*(A) at the ~1 x 1 km grid cell (B) commune and (C) district scales. The columns are ordered by the number or clinics at each step: baseline (N = 31), + 83 (1 per district), + 200, + 600, + 1406 (1 per commune), and max (+ 1696 clinics, all additional CSB IIs in the country). Grey pixels show the location of ARMC at each step. Commune and district values are the average grid cell travel times weighted by the population in each cell.*
\newpage

```{r fig S5.4 travel times(a) bite inc(b)}
include_graphics(here("analysis/figs/supplementary/S5.4_ttimes_bites.jpeg"))
```

### *Fig S5.4. Shifts in key metrics as clinics are added.* 
*(A) travel times (hrs, x-axis is square root transformed), (B) bite incidence per 100,000 persons and boxplots showing the median for communes and district models (colors).*
 \newpage
 
```{r fig S5.5 reporting(a) death inc(b)}
include_graphics(here("analysis/figs/supplementary/S5.5_reporting_shifts.jpeg"))
```

### *Fig S5.5. Shifts in  key metrics as clinics are added.*
*(A) reporting, (B) death incidence per 100,000 persons for the commune and district models (colors) as clinics are added.*
\newpage
  
```{r fig S5.6 catch(a) vials(b) throughput(c)}
include_graphics(here("analysis/figs/supplementary/S5.6_clinic_shifts.jpeg"))
```

### *Fig S5.6. Shifts in key metrics as clinics are added.*
*(A) catchment population size, (B) annual vial demand, and (C) daily throughput (i.e. average number of patients reporting each day) given estimates of bite incidence for the commune and district models (colors). For vial demand estimation, catchment population sizes are the same for each model as these populations are allocated at the grid cell level (i.e. population in a grid cell is allocated to the clinic catchment it is closest to in terms of travel times regardless of district or commune). All x-axes are log transformed.* 
\newpage
 

```{r fig S5.7 comm network}
include_graphics(here("analysis/figs/supplementary/S5.7_comm_map.jpeg"))
```

### *Fig S5.7. Shifts in where bites are reported to as clinics are added for the commune model.*
*The circles show the clinic locations for each scenario, with size proportional to the annual average bites reported to that clinic. Lines show where the bites are reported from (commune centroid) also proportional to the number of bites. The polygon shading shows the commune level reported bite incidence.*
\newpage

  
```{r fig S5.8 dist network}
include_graphics(here("analysis/figs/supplementary/S5.8_dist_map.jpeg"))
```

### *Fig S5.8. Shifts in where bites are reported to as clinics are added for the district model.*
*The circles show the clinic locations for each scenario, with size proportional to the annual average bites reported to that clinic. Lines show where the bites are reported from (commune centroid) also proportional to the number of bites. The polygon shading shows the district level reported bite incidence.*  
\newpage
 
## S6. Sensitivity of burden estimates to parameter assumptions {#S6}

```{r se tables}
se_pars <- read.csv(here("analysis/out/sensitivity/se_pars.csv"))

se_pars %>%
  pivot_longer(exp_min:beta_0) %>%
  mutate(value = case_when(name %in% c("exp_min", "exp_max") ~ round(value*1e5, 2),
                           !(name %in% c("exp_min", "exp_max")) ~ round(value, 2))) %>%
  group_by(scale, par = name) %>%
  summarize(upper = max(value), lower = min(value)) %>%
  mutate(range = glue("{lower} \U2012 {upper}")) -> se_table_all
  
se_table_all %>%
  filter(grepl("beta|sigma", par)) %>%
  pivot_wider(par, values_from = range, names_from = scale) %>%
  as.data.table(.) -> bites_se
se_table_all %>%
  filter(!grepl("beta|sigma|min", par), scale != "Commune") %>%
  as.data.table(.) -> dtree_se
```
  
### *Table S6.1. Range of parameters (upper 97.5% and lower 2.5% credible interval of posterior) used in models of bite incidence for the univariate sensitivity analyses.*

| **Parameter**   | **Description**        | **Commune model** | **District model** | 
|:----------------|:----------------------:|:----------------------------------:|:----------------------------------:|
| $\beta_t$ | Travel time effect	| `r bites_se[par == "beta_ttimes"]$Commune` | `r bites_se[par == "beta_ttimes"]$District`
| $\beta_0$ | Model intercept	| `r bites_se[par == "beta_0"]$Commune` | `r bites_se[par == "beta_0"]$District`
| $\sigma_0$ | Overdispersion	| `r bites_se[par == "sigma_e"]$Commune` | `r bites_se[par == "sigma_e"]$District`
  
\newpage
  
### *Table S6.2. Range of parameters used in decision tree model for the univariate sensitivity analyses.*

| **Parameter**   | **Description**        | **Range**	                 | **Notes**|
|:----------------|:----------------------:|:----------------------------|:---------:|
| $E_i$ |	Annual exposures per 100,000 persons| `r dtree_se[par == "exp_max"]$range`  	
| $p_{rabid}$	| Proportion of reported bites that are rabies exposures | `r dtree_se[par == "p_rab_max"]$range` 	
| $\rho_{max}$ | The maximum reporting possible for any location | `r dtree_se[par == "rho_max"]$range`	 
| $p_{death}$ | The probability of death given a rabies exposure^1^ | `r dtree_se[par == "p_death"]$range`	
^1^*95% CI of estimate from [@changaluchaNeedImproveAccess2018]*
  
\newpage
  

```{r fig S6.1 base se}
include_graphics(here("analysis/figs/supplementary/S6.1_base_se.jpeg"))
```

### *Fig S6.1. Sensitivity analyses for baseline burden estimates.*
*(A) Range of estimates of the estimate average deaths at the national level for range of parameter estimates (point shows the estimate presented in the main analyses and the ends show the upper and lower estimates for the parameter range) and (B) estimates for the predicted relationship between travel times and incidence of human rabies deaths across the same parameter ranges (line shows the estimate presented in the main analyses and the envelope shows the upper and lower estimates for the parameter range) for the two models (colors). See Table S6.1 & 2 for ranges used for each parameter.*
  
\newpage

```{r fig S6.2 add se}
include_graphics(here("analysis/figs/supplementary/S6.2_addARMC_se.jpeg"))
```

### *Fig S6.2. Sensitivity analysis for PEP expansion.*
*(A) Estimates of the maximum proportion reduction of deaths from the baseline for range of parameter estimates (point shows the estimate presented in the main analyses and the ends show the upper and lower estimates for the parameter range) and (B) estimates for how human rabies decreases proportional to the baseline as clinics are added for these same parameter ranges (line shows the mean estimate presented in the main analyses and the envelope shows the mean estimates for the parameters fixed at the upper and lower range) for the two models (colors). See Table S6.1 & 2 for ranges used for each parameter.*
  
 \newpage
 
```{r fig S6.3 vial se}
include_graphics(here("analysis/figs/supplementary/S6.3_vial_se.jpeg"))
```

### *Fig S6.3. Sensitivity analysis for vial demand.*
*(A) Estimates of the baseline vial demand for where each parameter was set to the upper and lower estimat of parameter estimates (point shows the estimate presented in the main analyses and the ends show the upper and lower estimates for the parameter range) and (B) estimates for how vial demand increases as clinics are added for these same parameter ranges (line shows the mean estimate presented in the main analyses and the envelope shows the mean estimates for the parameters fixed at the upper and lower range) for the two models (colors) for the two models (colors). See Table S6.1 & 2 for ranges used for each parameter.*
\newpage
 
```{r fig S6.4 scaling se}
include_graphics(here("analysis/figs/supplementary/S6.4_scaling_se.jpeg"))
```

### *Fig S6.4. Sensitivity analysis for exposure scaling with population.*
*Predicted relationship between (A) travel times and rabies death incidence per 100k persons and (B) the proportional reduction in deaths from the baseline as clinics are added for the district model vs. commune models (colors) with columns comparing the baseline (presented in main analyses) and assumptions of rabies exposure incidence increasing or decreasing with human population size (shapes). The points show the mean estimates from 1000 simulations and the line ranges show the 95% prediction intervals.*  

\newpage
  
## S7. Sotware citations {#srefs}
::: {#refs_supp}
:::

## S8. Additional supplementary references {#srefextra}
::: {#refs_supextra}
:::

